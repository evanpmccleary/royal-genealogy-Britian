<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>British Royal Family Tree - Complete Genealogy</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            overflow: hidden;
        }

        #container {
            display: flex;
            height: 100vh;
        }

        #sidebar {
            width: 350px;
            background: #2c3e50;
            color: #ecf0f1;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 24px;
            color: #3498db;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 14px;
            color: #bdc3c7;
            margin-bottom: 20px;
        }

        #search-box {
            width: 100%;
            padding: 10px;
            background: #34495e;
            border: 1px solid #7f8c8d;
            border-radius: 5px;
            color: #ecf0f1;
            font-size: 14px;
            margin-bottom: 15px;
        }

        #info-panel {
            background: #34495e;
            border: 1px solid #7f8c8d;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .info-section {
            margin-bottom: 15px;
        }

        .info-section h3 {
            font-size: 14px;
            color: #3498db;
            margin-bottom: 8px;
            border-bottom: 1px solid #7f8c8d;
            padding-bottom: 4px;
        }

        .info-name {
            font-size: 20px;
            color: #3498db;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .info-house {
            font-size: 14px;
            color: #95a5a6;
            margin-bottom: 15px;
        }

        .info-item {
            margin: 5px 0;
            font-size: 13px;
            line-height: 1.6;
        }

        .clickable-link {
            color: #5dade2;
            cursor: pointer;
            text-decoration: underline;
        }

        .clickable-link:hover {
            color: #3498db;
        }

        .extinct-marker {
            color: #e74c3c;
            font-style: italic;
        }

        #graph-container {
            flex: 1;
            position: relative;
            background: #ffffff;
        }

        #mynetwork {
            width: 100%;
            height: 100%;
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .control-btn {
            display: block;
            width: 120px;
            margin: 5px 0;
            padding: 8px;
            background: #3498db;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 12px;
        }

        .control-btn:hover {
            background: #2980b9;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .legend h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }

        .legend-color {
            width: 25px;
            height: 15px;
            border-radius: 3px;
            margin-right: 10px;
            border: 1px solid #34495e;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="sidebar">
            <h1>British Royal Family</h1>
            <div class="subtitle">Complete Genealogical Network • 519 AD - Present</div>

            <input type="text" id="search-box" placeholder="Search by name..." />

            <div id="info-panel">
                <div style="text-align: center; color: #95a5a6; padding: 40px 20px;">
                    Click on any person to see their complete family information.
                </div>
            </div>
        </div>

        <div id="graph-container">
            <div class="controls">
                <button class="control-btn" onclick="fitNetwork()">Fit View</button>
                <button class="control-btn" onclick="resetView()">Reset View</button>
            </div>

            <div class="legend">
                <h3>Dynasty Colors</h3>
                <div id="legend-content"></div>
            </div>

            <div id="mynetwork"></div>
        </div>
    </div>

    <script>
        // FIXED COLORS - Wessex is BLUE, Normandy is RED
        const dynastyColors = {
            "Wessex": "#0066cc",              // BLUE
            "Godwin": "#8b4513",              // Brown
            "Knýtlinga": "#228b22",           // Forest Green
            "Normandy": "#cc0000",            // RED
            "Blois": "#ff8c00",               // Dark Orange
            "Plantagenet": "#8b0000",         // Dark Red
            "Lancaster": "#dc143c",           // Crimson
            "York": "#ffffff",                // White
            "Tudor": "#ff6347",               // Tomato
            "Stuart": "#9370db",              // Medium Purple
            "Orange-Nassau": "#ff8c00",       // Orange
            "Hanover": "#ffd700",             // Gold
            "Saxe-Coburg and Gotha": "#daa520", // Goldenrod
            "Windsor": "#b8860b",             // Dark Goldenrod
            "Mercia": "#4682b4",              // Steel Blue
            "Flanders": "#20b2aa",            // Light Sea Green
            "Denmark": "#2e8b57",             // Sea Green
            "Dunkeld": "#8fbc8f",             // Dark Sea Green
            "Aquitaine": "#cd853f",           // Peru
            "Capet": "#6a5acd",               // Slate Blue
            "Valois": "#7b68ee"               // Medium Slate Blue
        };

        // Complete dataset (same as before but structured for Vis.js)
        const peopleData = [
            // WESSEX
            {id: "cerdic", name: "Cerdic", house: "Wessex", born: "c. 467", died: "534", children: ["cynric"], titles: ["King of Wessex 519-534"]},
            {id: "cynric", name: "Cynric", house: "Wessex", born: "c. 495", died: "560", father: "cerdic", children: ["ceawlin"], titles: ["King of Wessex 534-560"]},
            {id: "alfred_the_great", name: "Alfred the Great", house: "Wessex", born: "847", died: "899", father: "aethelwulf", mother: "osburh", spouses: ["ealhswith"], children: ["aethelflaed", "edward_the_elder", "aethelgifu", "aelfthryth", "aethelweard"], titles: ["King of Wessex 871-899"]},
            {id: "ealhswith", name: "Ealhswith", house: "Mercia", died: "902", spouses: ["alfred_the_great"], isSpouse: true},
            {id: "edward_the_elder", name: "Edward the Elder", house: "Wessex", born: "c. 874", died: "924", father: "alfred_the_great", mother: "ealhswith", spouses: ["ecgwynn", "aelfflaed", "eadgifu"], children: ["athelstan", "edmund_i", "eadred"], titles: ["King 899-924"]},
            {id: "athelstan", name: "Æthelstan", house: "Wessex", born: "c. 894", died: "939", father: "edward_the_elder", titles: ["King 927-939"], extinct: true},
            {id: "edmund_i", name: "Edmund I", house: "Wessex", born: "921", died: "946", father: "edward_the_elder", children: ["eadwig", "edgar_the_peaceful"], titles: ["King 939-946"]},
            {id: "eadred", name: "Eadred", house: "Wessex", born: "c. 923", died: "955", father: "edward_the_elder", titles: ["King 946-955"], extinct: true},
            {id: "eadwig", name: "Eadwig", house: "Wessex", born: "c. 940", died: "959", father: "edmund_i", titles: ["King 955-959"], extinct: true},
            {id: "edgar_the_peaceful", name: "Edgar", house: "Wessex", born: "943", died: "975", father: "edmund_i", children: ["edward_the_martyr", "aethelred_the_unready"], titles: ["King 959-975"]},
            {id: "edward_the_martyr", name: "Edward the Martyr", house: "Wessex", born: "c. 962", died: "978", father: "edgar_the_peaceful", titles: ["King 975-978"], extinct: true},
            {id: "aethelred_the_unready", name: "Æthelred the Unready", house: "Wessex", born: "c. 966", died: "1016", father: "edgar_the_peaceful", spouses: ["aelfgifu_york", "emma_normandy"], children: ["edmund_ironside", "edward_the_confessor"], titles: ["King 978-1016"]},
            {id: "emma_normandy", name: "Emma of Normandy", house: "Normandy", born: "c. 984", died: "1052", spouses: ["aethelred_the_unready", "cnut_great"], children: ["edward_the_confessor", "harthacnut"], isSpouse: true},
            {id: "edmund_ironside", name: "Edmund Ironside", house: "Wessex", born: "c. 990", died: "1016", father: "aethelred_the_unready", children: ["edward_exile"], titles: ["King 1016"]},
            {id: "edward_exile", name: "Edward the Exile", house: "Wessex", born: "1016", died: "1057", father: "edmund_ironside", children: ["edgar_aetheling", "margaret_scotland"]},
            {id: "edgar_aetheling", name: "Edgar Ætheling", house: "Wessex", born: "c. 1051", died: "c. 1125", father: "edward_exile", titles: ["Proclaimed 1066"], extinct: true, special: "RESEARCH SUBJECT"},
            {id: "margaret_scotland", name: "Margaret of Scotland", house: "Wessex", born: "c. 1045", died: "1093", father: "edward_exile", spouses: ["malcolm_iii"], children: ["david_i_scotland", "matilda_scotland"]},
            {id: "edward_the_confessor", name: "Edward the Confessor", house: "Wessex", born: "c. 1003", died: "1066", father: "aethelred_the_unready", mother: "emma_normandy", spouses: ["edith_godwin"], titles: ["King 1042-1066"], extinct: true},
            
            // GODWIN
            {id: "harold_godwinson", name: "Harold Godwinson", house: "Godwin", born: "c. 1022", died: "1066", children: ["godwine_harold"], titles: ["King Jan-Oct 1066"]},
            
            // DENMARK
            {id: "sweyn_forkbeard", name: "Sweyn Forkbeard", house: "Knýtlinga", born: "c. 960", died: "1014", children: ["cnut_great"], titles: ["King 1013-1014"]},
            {id: "cnut_great", name: "Cnut the Great", house: "Knýtlinga", born: "c. 990", died: "1035", father: "sweyn_forkbeard", spouses: ["emma_normandy"], children: ["harold_harefoot", "harthacnut"], titles: ["King 1016-1035"]},
            {id: "harold_harefoot", name: "Harold Harefoot", house: "Knýtlinga", born: "c. 1015", died: "1040", father: "cnut_great", titles: ["King 1035-1040"]},
            {id: "harthacnut", name: "Harthacnut", house: "Knýtlinga", born: "c. 1018", died: "1042", father: "cnut_great", mother: "emma_normandy", titles: ["King 1040-1042"]},
            
            // NORMANDY
            {id: "william_i", name: "William I", house: "Normandy", born: "c. 1028", died: "1087", father: "robert_i_normandy", spouses: ["matilda_flanders"], children: ["robert_curthose", "william_ii", "henry_i", "adela_normandy", "constance_brittany"], titles: ["King 1066-1087"]},
            {id: "matilda_flanders", name: "Matilda of Flanders", house: "Flanders", born: "c. 1031", died: "1083", spouses: ["william_i"], isSpouse: true},
            {id: "robert_curthose", name: "Robert Curthose", house: "Normandy", born: "c. 1051", died: "1134", father: "william_i", children: ["william_clito"], titles: ["Duke of Normandy"]},
            {id: "william_ii", name: "William II Rufus", house: "Normandy", born: "c. 1056", died: "1100", father: "william_i", titles: ["King 1087-1100"], extinct: true},
            {id: "henry_i", name: "Henry I", house: "Normandy", born: "1068", died: "1135", father: "william_i", spouses: ["matilda_scotland", "adeliza_louvain"], children: ["matilda_empress", "william_adelin"], titles: ["King 1100-1135"]},
            {id: "matilda_scotland", name: "Matilda of Scotland", house: "Dunkeld", born: "c. 1080", died: "1118", father: "malcolm_iii", mother: "margaret_scotland", spouses: ["henry_i"], isSpouse: true},
            {id: "adela_normandy", name: "Adela of Normandy", house: "Normandy", born: "c. 1067", died: "1137", father: "william_i", spouses: ["stephen_blois"], children: ["stephen_england"]},
            {id: "matilda_empress", name: "Matilda (Empress)", house: "Normandy", born: "1102", died: "1167", father: "henry_i", spouses: ["geoffrey_anjou"], children: ["henry_ii"], titles: ["Lady of English 1141"]},
            
            // BLOIS
            {id: "stephen_england", name: "Stephen", house: "Blois", born: "c. 1092", died: "1154", mother: "adela_normandy", children: ["eustace_blois"], titles: ["King 1135-1154"]},
            
            // PLANTAGENET
            {id: "henry_ii", name: "Henry II", house: "Plantagenet", born: "1133", died: "1189", mother: "matilda_empress", spouses: ["eleanor_aquitaine"], children: ["henry_young_king", "richard_i", "john_england"], titles: ["King 1154-1189"]},
            {id: "eleanor_aquitaine", name: "Eleanor of Aquitaine", house: "Aquitaine", born: "c. 1122", died: "1204", spouses: ["henry_ii"], isSpouse: true},
            {id: "richard_i", name: "Richard I", house: "Plantagenet", born: "1157", died: "1199", father: "henry_ii", titles: ["King 1189-1199"], extinct: true},
            {id: "john_england", name: "John", house: "Plantagenet", born: "1166", died: "1216", father: "henry_ii", children: ["henry_iii"], titles: ["King 1199-1216"]},
            {id: "henry_iii", name: "Henry III", house: "Plantagenet", born: "1207", died: "1272", father: "john_england", children: ["edward_i"], titles: ["King 1216-1272"]},
            {id: "edward_i", name: "Edward I", house: "Plantagenet", born: "1239", died: "1307", father: "henry_iii", children: ["edward_ii"], titles: ["King 1272-1307"]},
            {id: "edward_ii", name: "Edward II", house: "Plantagenet", born: "1284", died: "1327", father: "edward_i", children: ["edward_iii"], titles: ["King 1307-1327"]},
            {id: "edward_iii", name: "Edward III", house: "Plantagenet", born: "1312", died: "1377", father: "edward_ii", children: ["edward_black_prince", "lionel_antwerp", "john_gaunt", "edmund_langley"], titles: ["King 1327-1377"]},
            {id: "edward_black_prince", name: "Edward (Black Prince)", house: "Plantagenet", born: "1330", died: "1376", father: "edward_iii", children: ["richard_ii"]},
            {id: "richard_ii", name: "Richard II", house: "Plantagenet", born: "1367", died: "1400", father: "edward_black_prince", titles: ["King 1377-1399"], extinct: true},
            
            // LANCASTER
            {id: "john_gaunt", name: "John of Gaunt", house: "Lancaster", born: "1340", died: "1399", father: "edward_iii", children: ["henry_iv"], titles: ["Duke of Lancaster"]},
            {id: "henry_iv", name: "Henry IV", house: "Lancaster", born: "1367", died: "1413", father: "john_gaunt", children: ["henry_v"], titles: ["King 1399-1413"]},
            {id: "henry_v", name: "Henry V", house: "Lancaster", born: "1386", died: "1422", father: "henry_iv", spouses: ["catherine_valois"], children: ["henry_vi"], titles: ["King 1413-1422"]},
            {id: "catherine_valois", name: "Catherine of Valois", house: "Valois", born: "1401", died: "1437", spouses: ["henry_v", "owen_tudor"], children: ["henry_vi", "edmund_tudor"], isSpouse: true},
            {id: "henry_vi", name: "Henry VI", house: "Lancaster", born: "1421", died: "1471", father: "henry_v", children: ["edward_westminster"], titles: ["King 1422-1461, 1470-1471"]},
            
            // YORK
            {id: "edmund_langley", name: "Edmund of Langley", house: "York", born: "1341", died: "1402", father: "edward_iii", children: ["richard_cambridge"], titles: ["Duke of York"]},
            {id: "edward_iv", name: "Edward IV", house: "York", born: "1442", died: "1483", spouses: ["elizabeth_woodville"], children: ["edward_v", "richard_shrewsbury"], titles: ["King 1461-1470, 1471-1483"]},
            {id: "edward_v", name: "Edward V", house: "York", born: "1470", died: "c. 1483", father: "edward_iv", titles: ["King Apr-Jun 1483"], extinct: true},
            {id: "richard_iii", name: "Richard III", house: "York", born: "1452", died: "1485", titles: ["King 1483-1485"], extinct: true},
            
            // TUDOR
            {id: "edmund_tudor", name: "Edmund Tudor", house: "Tudor", born: "c. 1430", died: "1456", mother: "catherine_valois", children: ["henry_vii"]},
            {id: "henry_vii", name: "Henry VII", house: "Tudor", born: "1457", died: "1509", father: "edmund_tudor", spouses: ["elizabeth_york"], children: ["henry_viii", "margaret_tudor"], titles: ["King 1485-1509"]},
            {id: "elizabeth_york", name: "Elizabeth of York", house: "York", born: "1466", died: "1503", father: "edward_iv", spouses: ["henry_vii"], isSpouse: true},
            {id: "henry_viii", name: "Henry VIII", house: "Tudor", born: "1491", died: "1547", father: "henry_vii", children: ["mary_i", "elizabeth_i", "edward_vi"], titles: ["King 1509-1547"]},
            {id: "edward_vi", name: "Edward VI", house: "Tudor", born: "1537", died: "1553", father: "henry_viii", titles: ["King 1547-1553"], extinct: true},
            {id: "mary_i", name: "Mary I", house: "Tudor", born: "1516", died: "1558", father: "henry_viii", titles: ["Queen 1553-1558"], extinct: true},
            {id: "elizabeth_i", name: "Elizabeth I", house: "Tudor", born: "1533", died: "1603", father: "henry_viii", titles: ["Queen 1558-1603"], extinct: true},
            
            // STUART
            {id: "margaret_tudor", name: "Margaret Tudor", house: "Tudor", born: "1489", died: "1541", father: "henry_vii", spouses: ["james_iv_scotland"], children: ["james_v_scotland"]},
            {id: "james_i", name: "James I", house: "Stuart", born: "1566", died: "1625", children: ["charles_i"], titles: ["King 1603-1625"]},
            {id: "charles_i", name: "Charles I", house: "Stuart", born: "1600", died: "1649", father: "james_i", children: ["charles_ii", "james_ii"], titles: ["King 1625-1649"]},
            {id: "charles_ii", name: "Charles II", house: "Stuart", born: "1630", died: "1685", father: "charles_i", titles: ["King 1660-1685"], extinct: true},
            {id: "james_ii", name: "James II", house: "Stuart", born: "1633", died: "1701", father: "charles_i", children: ["mary_ii", "anne_gb"], titles: ["King 1685-1688"]},
            {id: "mary_ii", name: "Mary II", house: "Stuart", born: "1662", died: "1694", father: "james_ii", spouses: ["william_iii"], titles: ["Queen 1689-1694"], extinct: true},
            {id: "william_iii", name: "William III", house: "Orange-Nassau", born: "1650", died: "1702", spouses: ["mary_ii"], titles: ["King 1689-1702"], extinct: true},
            {id: "anne_gb", name: "Anne", house: "Stuart", born: "1665", died: "1714", father: "james_ii", titles: ["Queen 1702-1714"], extinct: true},
            
            // HANOVER
            {id: "george_i", name: "George I", house: "Hanover", born: "1660", died: "1727", children: ["george_ii"], titles: ["King 1714-1727"]},
            {id: "george_ii", name: "George II", house: "Hanover", born: "1683", died: "1760", father: "george_i", children: ["frederick_wales"], titles: ["King 1727-1760"]},
            {id: "frederick_wales", name: "Frederick (Prince)", house: "Hanover", born: "1707", died: "1751", father: "george_ii", children: ["george_iii"]},
            {id: "george_iii", name: "George III", house: "Hanover", born: "1738", died: "1820", father: "frederick_wales", children: ["george_iv", "william_iv"], titles: ["King 1760-1820"]},
            {id: "george_iv", name: "George IV", house: "Hanover", born: "1762", died: "1830", father: "george_iii", children: ["charlotte_wales"], titles: ["King 1820-1830"]},
            {id: "william_iv", name: "William IV", house: "Hanover", born: "1765", died: "1837", father: "george_iii", titles: ["King 1830-1837"], extinct: true},
            {id: "victoria", name: "Victoria", house: "Hanover", born: "1819", died: "1901", spouses: ["albert_saxe_coburg"], children: ["edward_vii"], titles: ["Queen 1837-1901"]},
            
            // WINDSOR
            {id: "edward_vii", name: "Edward VII", house: "Saxe-Coburg and Gotha", born: "1841", died: "1910", mother: "victoria", children: ["george_v"], titles: ["King 1901-1910"]},
            {id: "george_v", name: "George V", house: "Windsor", born: "1865", died: "1936", father: "edward_vii", children: ["edward_viii", "george_vi"], titles: ["King 1910-1936"]},
            {id: "edward_viii", name: "Edward VIII", house: "Windsor", born: "1894", died: "1972", father: "george_v", titles: ["King Jan-Dec 1936"], extinct: true},
            {id: "george_vi", name: "George VI", house: "Windsor", born: "1895", died: "1952", father: "george_v", children: ["elizabeth_ii"], titles: ["King 1936-1952"]},
            {id: "elizabeth_ii", name: "Elizabeth II", house: "Windsor", born: "1926", died: "2022", father: "george_vi", children: ["charles_iii"], titles: ["Queen 1952-2022"]},
            {id: "charles_iii", name: "Charles III", house: "Windsor", born: "1948", mother: "elizabeth_ii", children: ["william_wales", "harry_wales"], titles: ["King 2022-present"]}
        ];

        // Create nodes
        const nodes = new vis.DataSet(
            peopleData.map(person => {
                const color = dynastyColors[person.house] || "#999999";
                const fontColor = person.house === "York" ? "#000000" : "#ffffff";
                
                return {
                    id: person.id,
                    label: person.name,
                    title: person.house + "\n" + (person.born || "") + " - " + (person.died || ""),
                    color: {
                        background: color,
                        border: "#2c3e50",
                        highlight: {
                            background: color,
                            border: "#000000"
                        }
                    },
                    font: {
                        color: fontColor,
                        size: 14,
                        bold: true
                    },
                    shape: "box",
                    margin: 10,
                    widthConstraint: { minimum: 140, maximum: 140 },
                    heightConstraint: { minimum: 50 },
                    level: calculateLevel(person),
                    person: person
                };
            })
        );

        // Calculate generation level
        function calculateLevel(person) {
            // Simplified - assign based on birth year or approximate era
            if (person.born) {
                const year = parseInt(person.born.replace(/[^0-9]/g, ''));
                if (year < 600) return 0;
                if (year < 800) return 1;
                if (year < 900) return 2;
                if (year < 1000) return 3;
                if (year < 1100) return 4;
                if (year < 1200) return 5;
                if (year < 1300) return 6;
                if (year < 1400) return 7;
                if (year < 1500) return 8;
                if (year < 1600) return 9;
                if (year < 1700) return 10;
                if (year < 1800) return 11;
                if (year < 1900) return 12;
                if (year < 2000) return 13;
                return 14;
            }
            return 0;
        }

        // Create edges
        const edges = new vis.DataSet();

        peopleData.forEach(person => {
            // Parent-child relationships (SOLID LINES)
            if (person.father) {
                edges.add({
                    from: person.father,
                    to: person.id,
                    arrows: "to",
                    color: { color: "#7f8c8d" },
                    width: 2,
                    smooth: { type: "cubicBezier" }
                });
            }
            if (person.mother) {
                edges.add({
                    from: person.mother,
                    to: person.id,
                    arrows: "to",
                    color: { color: "#7f8c8d" },
                    width: 2,
                    smooth: { type: "cubicBezier" }
                });
            }
            
            // Marriage relationships (DOTTED LINES)
            if (person.spouses) {
                person.spouses.forEach(spouseId => {
                    // Only add marriage edge once (from lower ID to higher ID)
                    if (person.id < spouseId) {
                        edges.add({
                            from: person.id,
                            to: spouseId,
                            color: { color: "#e67e22" },
                            width: 2,
                            dashes: [5, 5],
                            smooth: { type: "horizontal" }
                        });
                    }
                });
            }
        });

        // Network options
        const options = {
            layout: {
                hierarchical: {
                    direction: "UD",
                    sortMethod: "directed",
                    nodeSpacing: 200,
                    levelSeparation: 150,
                    treeSpacing: 200
                }
            },
            physics: {
                enabled: false
            },
            interaction: {
                hover: true,
                zoomView: true,
                dragView: true
            },
            nodes: {
                borderWidth: 2,
                borderWidthSelected: 4
            }
        };

        // Initialize network
        const container = document.getElementById("mynetwork");
        const data = { nodes: nodes, edges: edges };
        const network = new vis.Network(container, data, options);

        // Click event
        network.on("click", function(params) {
            if (params.nodes.length > 0) {
                const nodeId = params.nodes[0];
                const person = peopleData.find(p => p.id === nodeId);
                if (person) {
                    showPersonInfo(person);
                }
            }
        });

        // Show person info
        function showPersonInfo(person) {
            const panel = document.getElementById("info-panel");
            
            let html = `
                <div class="info-name">${person.name}</div>
                <div class="info-house">House of ${person.house}</div>
            `;

            if (person.born || person.died) {
                html += `<div class="info-section"><h3>LIFE</h3>`;
                if (person.born) html += `<div class="info-item">Born: ${person.born}</div>`;
                if (person.died) html += `<div class="info-item">Died: ${person.died}</div>`;
                if (person.extinct) html += `<div class="info-item extinct-marker">⚠ Line extinct</div>`;
                html += `</div>`;
            }

            if (person.titles && person.titles.length > 0) {
                html += `<div class="info-section"><h3>TITLES</h3>`;
                person.titles.forEach(title => {
                    html += `<div class="info-item">• ${title}</div>`;
                });
                html += `</div>`;
            }

            if (person.father || person.mother) {
                html += `<div class="info-section"><h3>PARENTS</h3>`;
                if (person.father) {
                    const father = peopleData.find(p => p.id === person.father);
                    html += `<div class="info-item">• Father: <span class="clickable-link" onclick="focusPerson('${person.father}')">${father ? father.name : person.father}</span></div>`;
                }
                if (person.mother) {
                    const mother = peopleData.find(p => p.id === person.mother);
                    html += `<div class="info-item">• Mother: <span class="clickable-link" onclick="focusPerson('${person.mother}')">${mother ? mother.name : person.mother}</span></div>`;
                }
                html += `</div>`;
            }

            if (person.spouses && person.spouses.length > 0) {
                html += `<div class="info-section"><h3>SPOUSE(S)</h3>`;
                person.spouses.forEach(spouseId => {
                    const spouse = peopleData.find(p => p.id === spouseId);
                    if (spouse) {
                        html += `<div class="info-item">• <span class="clickable-link" onclick="focusPerson('${spouseId}')">${spouse.name}</span> (House of ${spouse.house})</div>`;
                    }
                });
                html += `</div>`;
            }

            if (person.children && person.children.length > 0) {
                html += `<div class="info-section"><h3>CHILDREN</h3>`;
                person.children.forEach(childId => {
                    const child = peopleData.find(p => p.id === childId);
                    if (child) {
                        html += `<div class="info-item">• <span class="clickable-link" onclick="focusPerson('${childId}')">${child.name}</span>`;
                        if (child.extinct) html += ` <span class="extinct-marker">[EXTINCT]</span>`;
                        html += `</div>`;
                    }
                });
                html += `</div>`;
            }

            panel.innerHTML = html;
        }

        window.focusPerson = function(personId) {
            const person = peopleData.find(p => p.id === personId);
            if (person) {
                showPersonInfo(person);
                network.selectNodes([personId]);
                network.focus(personId, {
                    scale: 1.5,
                    animation: true
                });
            }
        };

        // Controls
        window.fitNetwork = function() {
            network.fit({ animation: true });
        };

        window.resetView = function() {
            network.fit({ animation: true });
        };

        // Search
        document.getElementById("search-box").addEventListener("input", (e) => {
            const query = e.target.value.toLowerCase();
            if (query.length >= 2) {
                const matches = peopleData.filter(p => 
                    p.name.toLowerCase().includes(query)
                );
                if (matches.length > 0) {
                    focusPerson(matches[0].id);
                }
            }
        });

        // Legend
        function createLegend() {
            const container = document.getElementById("legend-content");
            const sortedDynasties = Object.keys(dynastyColors).sort();
            
            sortedDynasties.forEach(dynasty => {
                const item = document.createElement("div");
                item.className = "legend-item";
                item.innerHTML = `
                    <div class="legend-color" style="background-color: ${dynastyColors[dynasty]}"></div>
                    <div>${dynasty}</div>
                `;
                container.appendChild(item);
            });
        }

        createLegend();
        
        // Initial fit
        setTimeout(() => {
            network.fit({ animation: false });
        }, 500);
    </script>
</body>
</html>